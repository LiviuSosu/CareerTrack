{
	"info": {
		"_postman_id": "76964251-8b71-ec14-3683-4f35de415e9e",
		"name": "CareerTrack",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Users",
			"item": [
				{
					"name": "Login",
					"item": [
						{
							"name": "Admin Success",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "af992b76-7bab-4ec0-a10c-e1082adccb84",
										"exec": [
											"pm.test(\"Log failed as admin user\", function () {\r",
											"     pm.response.to.have.status(200);\r",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Username\":\"{{AdminUsername}}\",\r\n    \"Password\":\"{{AdminPassword}}\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{authServiceUrl}}",
									"host": [
										"{{authServiceUrl}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Standard User Success",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "5f8ad265-c0a0-4525-ad15-0c1ebaa3c050",
										"exec": [
											"pm.test(\"Log succesfully as standard user\", function () {\r",
											"     pm.response.to.have.status(200);\r",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Username\":\"Stduser\",\r\n    \"Password\":\"StdPassword@123\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{authServiceUrl}}",
									"host": [
										"{{authServiceUrl}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Standard User Fail (password)",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "1207ef44-dfd0-4747-ad7d-8c2322af2bc5",
										"exec": [
											"pm.test(\"Log failed as standard user\", function () {\r",
											"     pm.response.to.have.status(401);\r",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Username\":\"StdUser\",\r\n    \"Password\":\"WrongPassword\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{authServiceUrl}}",
									"host": [
										"{{authServiceUrl}}"
									]
								},
								"description": "for wrong password"
							},
							"response": []
						},
						{
							"name": "Sandaerd User Fail (user)",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "33fd0a44-d533-4d71-9ae1-f95594ab3276",
										"exec": [
											"pm.test(\"Log failed as standard user\", function () {\r",
											"     pm.response.to.have.status(401);\r",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Username\":\"WrongUser\",\r\n    \"Password\":\"StdPassword@123\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{authServiceUrl}}",
									"host": [
										"{{authServiceUrl}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Admin Fail (user)",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "070547b2-a3dc-4e59-827c-3d5c28daa213",
										"exec": [
											"pm.test(\"Log failed as admin user\", function () {\r",
											"     pm.response.to.have.status(401);\r",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Username\":\"WrongAdmin\",\r\n    \"Password\":\"{{AdminPassword}}\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{authServiceUrl}}",
									"host": [
										"{{authServiceUrl}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Admin Fail (password)",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "3abb5603-9715-40f5-afe2-2bb1995704df",
										"exec": [
											"pm.test(\"Log failed as admin user\", function () {\r",
											"     pm.response.to.have.status(401);\r",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Username\":\"{{AdminUsername}}\",\r\n    \"Password\":\"WrongPassword\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{authServiceUrl}}",
									"host": [
										"{{authServiceUrl}}"
									]
								}
							},
							"response": []
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				}
			],
			"protocolProfileBehavior": {}
		},
		{
			"name": "Articles",
			"item": [
				{
					"name": "Read",
					"item": [
						{
							"name": "GetArticles",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "cc6d7c61-d463-4592-97bc-9c1672fdfe26",
										"exec": [
											"pm.test(\"Get articles\", function () {\r",
											"     pm.response.to.have.status(200);\r",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "c0a07bdc-1153-44a9-96eb-a9dee6f824b4",
										"exec": [
											"var authServiceUrl = pm.environment.get(\"authServiceUrl\");\r",
											"var username = pm.environment.get(\"StdUser\");\r",
											"var password = pm.environment.get(\"StdUserPassword\");\r",
											"\r",
											"var sdk = require('postman-collection');\r",
											"\r",
											"var isValidTokenRequest = new sdk.Request({\r",
											"    url: pm.environment.get(\"base_url\")+'Articles/GetArticles?pagesize=6',\r",
											"    method: 'GET',\r",
											"    header: [\r",
											"        new sdk.Header({\r",
											"            key: 'content-type',\r",
											"            value: 'application/json',\r",
											"        }),\r",
											"        new sdk.Header({\r",
											"            key: 'acccept',\r",
											"            value: 'application/json',\r",
											"        }),\r",
											"        new sdk.Header({\r",
											"            key: 'Authorization',\r",
											"            value: 'Bearer ' + pm.environment.get(\"jwttoken\"),\r",
											"        }),\r",
											"    ]\r",
											"});\r",
											"\r",
											"pm.sendRequest(isValidTokenRequest, function (err, response) {\r",
											"    if (response.code === 401) {\r",
											"        refreshToken();\r",
											"    }\r",
											"});\r",
											"\r",
											"function refreshToken() {\r",
											"    var tokenRequest = new sdk.Request({\r",
											"    url: authServiceUrl,\r",
											"    method: 'POST',\r",
											"    header: [\r",
											"        new sdk.Header({\r",
											"            key: 'content-type',\r",
											"            value: 'application/json'\r",
											"        }),\r",
											"        new sdk.Header({\r",
											"            key: 'acccept',\r",
											"            value: 'application/json'\r",
											"        }),\r",
											"    ],\r",
											"    body: {\r",
											"        mode: 'raw',\r",
											"        raw: JSON.stringify({\r",
											"            username: username,\r",
											"            password: password\r",
											"        })\r",
											"    } \r",
											"  });\r",
											"\r",
											"  pm.sendRequest(tokenRequest, function (err, response) {\r",
											"      if (err) {\r",
											"          throw err;\r",
											"      }\r",
											"      \r",
											"      if (response.code !== 200) {\r",
											"          throw new Error('Could not log in.');\r",
											"      }\r",
											"      \r",
											"      pm.environment.set(\"jwttoken\", response.json().token);\r",
											"      console.log(`New token has been set: ${response.json().token}`);\r",
											"  });\r",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlcyI6IlN0YW5kYXJkVXNlciIsImV4cCI6MTU5NzUyNDEzMCwiaXNzIjoiQ2FyZWVyVHJhY2siLCJhdWQiOiJNeVN1cGVyU2VjdXJlS2V5In0.eqf4zBOu31MUkYYMltc1S1xm5tFpQ4YaluHU_6DpEm8",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{base_url}}Articles/GetArticles?pagesize=6",
									"host": [
										"{{base_url}}Articles"
									],
									"path": [
										"GetArticles"
									],
									"query": [
										{
											"key": "pagesize",
											"value": "6"
										}
									]
								}
							},
							"response": []
						},
						{
							"name": "GetArticle",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "57e024fe-5cf3-49d9-8996-e8ccc069ebe9",
										"exec": [
											"pm.test(\"Get article by id\", function () {\r",
											"     pm.response.to.have.status(200);\r",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "c1d7215c-48fc-48cc-b83e-ed6bd9e29ea5",
										"exec": [
											"//https://nicolaswidart.com/blog/automatically-set-authentication-tokens-in-postman-requests\r",
											"//https://gist.github.com/bcnzer/073f0fc0b959928b0ca2b173230c0669\r",
											"var authServiceUrl = pm.environment.get(\"authServiceUrl\");//'https://localhost:44333/api/Users/login';\r",
											"var username = pm.environment.get(\"StdUser\");\r",
											"var password = pm.environment.get(\"StdUserPassword\");\r",
											"\r",
											"var sdk = require('postman-collection');\r",
											"\r",
											"var isValidTokenRequest = new sdk.Request({\r",
											"    url: pm.environment.get(\"base_url\")+'Articles/GetArticle?Id=' +pm.environment.get(\"GetArticleId\"),\r",
											"    method: 'GET',\r",
											"    header: [\r",
											"        new sdk.Header({\r",
											"            key: 'content-type',\r",
											"            value: 'application/json',\r",
											"        }),\r",
											"        new sdk.Header({\r",
											"            key: 'acccept',\r",
											"            value: 'application/json',\r",
											"        }),\r",
											"        new sdk.Header({\r",
											"            key: 'Authorization',\r",
											"            value: 'Bearer ' + pm.environment.get(\"jwttoken\"),\r",
											"        }),\r",
											"    ]\r",
											"});\r",
											"\r",
											"pm.sendRequest(isValidTokenRequest, function (err, response) {\r",
											"    if (response.code === 401) {\r",
											"        refreshToken();\r",
											"    }\r",
											"});\r",
											"\r",
											"function refreshToken() {\r",
											"    var tokenRequest = new sdk.Request({\r",
											"    url: authServiceUrl,\r",
											"    method: 'POST',\r",
											"    header: [\r",
											"        new sdk.Header({\r",
											"            key: 'content-type',\r",
											"            value: 'application/json'\r",
											"        }),\r",
											"        new sdk.Header({\r",
											"            key: 'acccept',\r",
											"            value: 'application/json'\r",
											"        }),\r",
											"    ],\r",
											"    body: {\r",
											"        mode: 'raw',\r",
											"        raw: JSON.stringify({\r",
											"            username: username,\r",
											"            password: password\r",
											"        })\r",
											"    } \r",
											"  });\r",
											"\r",
											"  pm.sendRequest(tokenRequest, function (err, response) {\r",
											"      if (err) {\r",
											"          throw err;\r",
											"      }\r",
											"      \r",
											"      if (response.code !== 200) {\r",
											"          throw new Error('Could not log in.');\r",
											"      }\r",
											"      \r",
											"      pm.environment.set(\"jwttoken\", response.json().token);\r",
											"      console.log(`New token has been set: ${response.json().token}`);\r",
											"  });\r",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [
									{
										"key": "Authorization",
										"value": "Bearer {{jwttoken}}",
										"type": "text"
									}
								],
								"url": {
									"raw": "{{base_url}}Articles/GetArticle?Id={{GetArticleId}}",
									"host": [
										"{{base_url}}Articles"
									],
									"path": [
										"GetArticle"
									],
									"query": [
										{
											"key": "Id",
											"value": "{{GetArticleId}}"
										}
									]
								}
							},
							"response": []
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				},
				{
					"name": "Command",
					"item": [
						{
							"name": "Create Article - success",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "4cda74df-0aa9-4b03-a78b-ae228ecbe85e",
										"exec": [
											"pm.test(\"Create article\", function () {\r",
											"     pm.response.to.have.status(200);\r",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "22cd0449-6f82-45c0-a41a-333b50e0d370",
										"exec": [
											"var authServiceUrl = pm.environment.get(\"authServiceUrl\");\r",
											"var username = pm.environment.get(\"StdUser\");\r",
											"var password = pm.environment.get(\"AdminPassword\");\r",
											"\r",
											"var sdk = require('postman-collection');\r",
											"\r",
											"var isValidTokenRequest = new sdk.Request({\r",
											"    url: pm.environment.get(\"base_url\")+'Articles/GetArticles?pagesize=6',\r",
											"    method: 'POST',\r",
											"    header: [\r",
											"        new sdk.Header({\r",
											"            key: 'content-type',\r",
											"            value: 'application/json',\r",
											"        }),\r",
											"        new sdk.Header({\r",
											"            key: 'acccept',\r",
											"            value: 'application/json',\r",
											"        }),\r",
											"        new sdk.Header({\r",
											"            key: 'Authorization',\r",
											"            value: 'Bearer ' + pm.environment.get(\"jwttoken\"),\r",
											"        }),\r",
											"    ],\r",
											"    body: {\r",
											"         mode: 'raw',\r",
											"        raw: JSON.stringify({\r",
											"            Title: \"Some article ziua 3.2\",\r",
											"            Link: \"test link\"\r",
											"        })\r",
											"    }\r",
											"});\r",
											"\r",
											"pm.sendRequest(isValidTokenRequest, function (err, response) {\r",
											"    if (response.code === 401) {\r",
											"        refreshToken();\r",
											"    }\r",
											"});\r",
											"\r",
											"function refreshToken() {\r",
											"    var tokenRequest = new sdk.Request({\r",
											"    url: authServiceUrl,\r",
											"    method: 'POST',\r",
											"    header: [\r",
											"        new sdk.Header({\r",
											"            key: 'content-type',\r",
											"            value: 'application/json'\r",
											"        }),\r",
											"        new sdk.Header({\r",
											"            key: 'acccept',\r",
											"            value: 'application/json'\r",
											"        }),\r",
											"    ],\r",
											"    body: {\r",
											"        mode: 'raw',\r",
											"        raw: JSON.stringify({\r",
											"            username: username,\r",
											"            password: password\r",
											"        })\r",
											"    } \r",
											"  });\r",
											"\r",
											"  pm.sendRequest(tokenRequest, function (err, response) {\r",
											"      if (err) {\r",
											"          throw err;\r",
											"      }\r",
											"      \r",
											"      if (response.code !== 200) {\r",
											"          throw new Error('Could not log in.');\r",
											"      }\r",
											"      \r",
											"      pm.environment.set(\"jwttoken\", response.json().token);\r",
											"      console.log(`New token has been set: ${response.json().token}`);\r",
											"  });\r",
											"}"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlcyI6IkFkbWluIiwiZXhwIjoxNTk3NTI0MDgxLCJpc3MiOiJDYXJlZXJUcmFjayIsImF1ZCI6Ik15U3VwZXJTZWN1cmVLZXkifQ.AVLlhRsjyxPozhWriAb842xksvKPqjeyEZdJmVnx-FE",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\r\n    \"Title\": \"Some article ziua 3.2\",\r\n    \"Link\": \"test link\"\r\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{base_url}}Articles/AddArticle",
									"host": [
										"{{base_url}}Articles"
									],
									"path": [
										"AddArticle"
									]
								}
							},
							"response": []
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				}
			],
			"protocolProfileBehavior": {}
		}
	],
	"protocolProfileBehavior": {}
}